#server-side-paramenter-pollution #HTTP-parameter-polliton

<style>
.red {
    color: red;
}
</style>

Se produce cuando un sitio web incorpora entradas del usuario en una solicitud del lado del servidor a una API interna sin la codificaci칩n adecuada. Esto significa que un atacante puede ser capaz de manipular o inyectar par치metros, lo que puede permitirle, por ejemplo:

- Anular par치metros existentes (override parameters).  
- Modificar el comportamiento de la aplicaci칩n.  
- Acceder a datos no autorizados.

> Un ejemplo de parametros son: forms fields, query params, headers, path params, etc.

# Testing Server side parameter pollution in query string

Usar query syntax como `#`,`&`, `=` en el input y observar un cambio de comportamiento

Ej de del front

```c
GET /userSearch?name=peter&back=/home
```
Ej: de ruta de server:

```c
GET /users/search?name=peter&publicProfile=true
```

## Truncando query strings

Usamos `#` encodeado para truncar la peticion en el lado del servidor

```c
GET /userSearch?name=peter%23foo&back=/home
```

cuando la recibe la API lo desencodea y  manda la peticion con la query truncada

```python
GET /users/search?name=peter#foo&publicProfile=true
```

si nos retorna al usuario peter, probablemente nos haya truncado la peticion. Si tira error, la api quizas esta tomando a `#foo` como parte del username.

## Inyectando parametros invalidos

Usamos `&` encodeado para intentar agregar un parametro a la peticion en el lado del servidor.

```c
GET /userSearch?name=peter%26foo=xyz&back=/home
```

cuando la recibe la API lo desencodea y la manda a la peticion interna

```c
GET /users/search?name=peter&foo=xyz&publicProfile=true
```

Observemos la respuesta, si esta no tuvo cambios, esto puede indacar que el parametro fue inyectado exitosamente pero fue pero ignorado por el BE.

## Inyectando parametros validos

Si vemos que tenemos capacidad de inyeccion, podemos intentar agregar un parametro valido a la request

Ej: `email`
```c
GET /userSearch?name=peter%26email=foo&back=/home
```

```c
GET /users/search?name=peter&email=foo&publicProfile=true
```

## Anular parametros existentes

Se puede validar el server-side parameter pollution agregando un parametro ya existente

```c
GET /userSearch?name=peter%26name=carlos&back=/home
```

```c
GET /users/search?name=peter&name=carlos&publicProfile=true
```

```python
GET /users/search?name=peter&name=administrator#&publicProfile=true
```

El impacto de esto depende de la tecnologia y como lo procese al segundo parametro la aplicacion.

- PHP parsea el ultimo parametro unicamente, buscado solo`carlos`.
- ASP.NET combina los 2 parametros, buscando `peter,carlos`, el cual podria dar un mensaje de error `Invalid username`.
- Node.js / express parses the first parameter only. This would result in a user search for `peter`, giving an unchanged result.


| LAB [Exploiting server-side parameter pollution in a query string](https://portswigger.net/web-security/api-testing/server-side-parameter-pollution/lab-exploiting-server-side-parameter-pollution-in-query-string)

| Diccionario para discovery de parametros: [SecLists/Discovery/Web-Content/burp-parameter-names.txt](https://github.com/danielmiessler/SecLists/tree/master/Discovery/Web-Content/burp-parameter-names.txt)



asdadsasd