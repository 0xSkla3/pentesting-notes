## Resumen

El objetivo de esta sección del PTES es presentar y explicar las herramientas y técnicas disponibles que ayudan en la etapa de pre-compromiso exitosa de una prueba de penetración. Una prueba de penetración no debería ser confrontativa. No debería ser una actividad para ver si el examinador puede "hackearlo". Debería tratarse de identificar el riesgo comercial asociado con un ataque.

Para obtener el valor máximo, asegúrese de que se cubran las preguntas en este documento. Además, a medida que avanza la actividad de definición de alcance, una buena empresa de pruebas comenzará a hacer preguntas adicionales adaptadas a su organización.

## Introducción al Alcance

La definición del alcance es uno de los aspectos más importantes y más pasados por alto también. Un componente clave para delimitar el alcance es establecer como los probadores deben gastar su tiempo.

un ejemplo de esto puede ser un cliente que ofrece 100k USD para probar 100 ips, pagando 1k USD por ip. Una trampa común en la que algunos probadores caen es mantener los costos lineales durante todo el proceso de prueba. Si el cliente solo hubiera pedido que se probara una aplicación crítica para el negocio al mismo precio ($1.000), aunque el probador seguirá atacando solo una dirección IP, el volumen de trabajo ha aumentado drásticamente.

No es raro que un cliente no tenga ni idea de lo que necesita que se pruebe. También es posible que el cliente no sepa cómo comunicar efectivamente lo que espera de la prueba. Es importante que en la fase de Pre-Engagement, el probador pueda servir como guía a través de lo que puede ser un territorio desconocido para un cliente. El probador debe entender la diferencia entre una prueba que se centra en una sola aplicación con una intensidad severa y una prueba donde el cliente proporciona una amplia gama de direcciones IP para probar y el objetivo es simplemente encontrar una forma de entrar.

## Métricas para la Estimación de Tiempo

Las estimaciones de tiempo están directamente relacionadas con la experiencia del tester en un área específica. Si un tester tiene una experiencia significativa en cierta prueba, es probable que innatamente pueda determinar cuánto tiempo llevará la prueba. Si el tester cuenta con menos experiencia, se recomienda la lectura de emails y registros de escaneos previos para poder estimar. Una vez determinado el tiempo, se le agrega un 20% del tiempo como margen de seguridad. Fuera del ámbito de consultoría, este tiempo se conoce como costo indirecto del consultor. Este margen es necesario para cubrir cualquier tipo de interrupción de la prueba, ya sea por ejemplo un segmento de red caída o una vulnerabilidad crítica importante que requiera muchas reuniones con muchos niveles de gestión para poder abordarla.

En caso de que no se utilice el 20%, se suele agregar valor adicional que normalmente no se hubiera entregado en caso de usarse el margen. Ejemplos de este valor puede ser:
- guiar al equipo de seguridad a través de los pasos tomados para explorar la vulnerabilidad.
- Proporcionar un resumen ejecutivo si no formaba como parte del entregable inicial.
- Dedicar tiempo adicional a intentar romper una vulnerabilidad que se dejó fuera durante la prueba inicial.

Cada proyecto debe tener una fecha de finalización definida. Deberá tener un acuerdo de trabajo firmado que especifique el trabajo y las horas requeridas si se ha alcanzado la fecha específica en que la prueba debe finalizar, o si se le solicita cualquier prueba o trabajo adicional después de esa fecha.


## Reunión de alcance 

El objetivo de la reunión de alcance es discutir qué será probado. Las reglas de compromiso y los costos no serán cubiertos en esta reunión. Cada uno de estos temas debe ser manejado en reuniones en las que cada pieza sea el foco de esa reunión.

Ahora que se ha establecido un valor aproximado del proyecto, es hora de tener una reunión con el cliente para validar suposiciones. Primero, es necesario establecer explícitamente qué rangos de IP están en el alcance del compromiso. No es raro que un cliente sea resistente y asuma que es la prerrogativa del tester identificar su red y atacarla para hacer la prueba lo más realista posible. Esto sería, de hecho, una circunstancia ideal, sin embargo, se deben considerar posibles ramificaciones legales por encima de todo. Debido a esto, es responsabilidad del tester transmitir a un cliente estas preocupaciones e impartirles la importancia del alcance implícito. Por ejemplo, en la reunión, se debe verificar que el cliente posee todos los entornos objetivos, incluyendo: el servidor DNS, el servidor de correo electrónico, el hardware real en el que se ejecutan sus servidores web y su solución de firewall/IDS/IPS. Hay varias empresas que terciarizan la gestión de estos dispositivos a terceros.

Las leyes varían de una región a otra y las pruebas pueden verse muy afectadas por estas leyes. Por ejemplo, los países pertenecientes a la Unión Europea son conocidos por tener leyes muy estrictas sobre la privacidad de los individuos, lo que puede cambiar significativamente la forma en que se ejecutaría un compromiso de ingeniería social.

## Soporte Adicional Basado en Tarifa por Hora

Cualquier cosa que no esté explícitamente cubierta dentro del alcance del compromiso debe ser manejada con mucho cuidado. La primera razón de esto es el alcance desmedido. Esto puede traer varios problemas, entre los más comunes tenemos: 
- A medida que el alcance se expande, se consumen recursos, reduciendo las ganancias para el tester y puede incluso crear confusión e ira por parte del cliente.
- Las ramificaciones legales.
Muchas solicitudes improvisadas no están documentadas adecuadamente, por lo que puede ser difícil determinar quién dijo qué en caso de una disputa o acción legal. Además, el contrato es un documento legal que especifica el trabajo que se debe realizar. Debe estar estrechamente ligado al permiso para realizar pruebas.

Cualquier solicitud fuera del alcance original debe ser documentada en forma de una declaración de trabajo que identifique claramente el trabajo que se debe realizar. También se recomienda que se indique claramente en el contrato que el trabajo adicional se realizara por una tarifa fija por hora y que se especifique explícitamente que el trabajo adicional no puede ser completado hasta que se haya firmado y contrafirmado una declaración de trabajo con carácter legal.

## Preguntas Generales

### Network Penetración Test

1. ¿Por qué el cliente está haciendo que se realice la prueba de penetración en su entorno?
2. ¿Se requiere la prueba de penetración para un requisito de cumplimiento específico?
3. ¿Cuándo desea el cliente que se realicen las partes activas (escaneo, enumeración, explotación, etc.) de la prueba de penetración?
	1. ¿Durante las horas de trabajo?
	2. ¿Después de las horas de trabajo?
	3. ¿Durante los fines de semana?
4. ¿Cuántas direcciones IP en total se están probando?
    1. ¿Cuántas direcciones IP internas, si corresponde?
    2. ¿Cuántas direcciones IP externas, si corresponde?
5. ¿Hay dispositivos en su lugar que puedan afectar los resultados de una prueba de penetración, como un firewall, sistema de detección / prevención de intrusiones, firewall de aplicaciones web o equilibrador de carga?
6. En caso de que se penetre un sistema, ¿cómo debe proceder el equipo de prueba?
    1. ¿Realizar una evaluación local de vulnerabilidades en la máquina comprometida?
    2. ¿Intentar obtener los privilegios más altos (root en máquinas Unix, SYSTEM o Administrator en máquinas Windows) en la máquina comprometida?
    3. ¿Realizar ataques de contraseñas no, mínimos, de diccionario o exhaustivos contra los hashes de contraseñas locales obtenidos (por ejemplo, /etc/shadow en máquinas Unix)?

### Prueba de penetración de aplicaciones web

1. ¿Cuántas aplicaciones web se están evaluando?
2. ¿Cuántos sistemas de inicio de sesión se están evaluando?
3. ¿Cuántas páginas estáticas se están evaluando? (aproximado)
4. ¿Cuántas páginas dinámicas se están evaluando? (aproximado)
5. ¿Se pondrá el código fuente a disposición fácilmente?
6. ¿Habrá algún tipo de documentación?
    1. Si es así, ¿qué tipo de documentación?
7. ¿Se realizará un análisis estático en esta aplicación?
8. ¿El cliente desea que se realice fuzzing en esta aplicación?
9. ¿El cliente desea que se realice pruebas basadas en roles en esta aplicación?
10. ¿El cliente desea que se realicen escaneos de credenciales en aplicaciones web?

### Prueba de Penetración de Red Inalámbrica

1. ¿Cuántas redes inalámbricas están en su lugar?
2. ¿Se utiliza una red inalámbrica para invitados? Si es así:
    1. ¿La red de invitados requiere autenticación?
    2. ¿Qué tipo de cifrado se utiliza en las redes inalámbricas?
    3. ¿Cuál es la superficie de cobertura en pies cuadrados?
    4. ¿Será necesario el registro de dispositivos no autorizados?
    5. ¿El equipo estará evaluando ataques inalámbricos contra clientes?
    6. ¿Aproximadamente cuántos clientes utilizarán la red inalámbrica?

### Prueba de Penetración Física

1. ¿Cuántas ubicaciones se están evaluando?
2. ¿Esta ubicación física es una instalación compartida? Si es así:
    1. ¿Cuántos pisos están dentro del alcance?
    2. ¿Qué pisos están dentro del alcance?
3. ¿Existen guardias de seguridad que deban ser evitados? Si es así:
    1. ¿Los guardias de seguridad son empleados a través de un tercero?
    2. ¿Están armados?
    3. ¿Se les permite usar la fuerza?
4. ¿Cuántas entradas hay al edificio?
5. ¿Se permite el uso de ganzúas o llaves bump? (también considerar las leyes locales)
6. ¿Es el propósito de esta prueba verificar el cumplimiento de las políticas y procedimientos existentes o para realizar una auditoría?
7. ¿Cuál es el área en alcance en pies cuadrados?
8. ¿Están documentadas todas las medidas de seguridad física?
9. ¿Se están usando cámaras de video?
    1. ¿Las cámaras son propiedad del cliente? Si es así:
        1. ¿Debería el equipo intentar acceder a donde se almacenan los datos de las cámaras de video?
10. ¿Se está usando un sistema de alarma armado? Si es así:
    1. ¿Es la alarma silenciosa?
    2. ¿Se activa la alarma por movimiento?
    3. ¿Se activa la alarma por apertura de puertas y ventanas?

### Ingeniería social

1. ¿El cliente tiene una lista de direcciones de correo electrónico sobre las cuales deseen realizar un ataque de ingeniería social?
2. ¿El cliente tiene una lista de números de teléfono sobre los cuales deseen realizar un ataque de ingeniería social?
3. ¿Se ha aprobado el uso de la ingeniería social con el propósito de obtener acceso físico no autorizado? Si es así:
    1. ¿Cuántas personas serán el objetivo?


	|Se debe tener en cuenta que, como parte de diferentes niveles de pruebas, puede que no sea necesario hacer preguntas a los Administradores de Unidades de Negocio, Administradores de Sistemas y Personal de Soporte Técnico. Sin embargo, en caso de que sea necesario, se proporcionan algunas preguntas de muestra a continuación.

#### Preguntas para Gerentes de Unidades de Negocio

1. ¿El gerente está al tanto de que se llevará a cabo una prueba?
2. ¿Cuál es el dato principal que representaría el mayor riesgo para la organización si fuera expuesto, corrompido o eliminado?
3. ¿Hay procedimientos de prueba y validación para verificar que las aplicaciones de negocios estén funcionando correctamente?
4. ¿Los evaluadores tendrán acceso a los procedimientos de prueba de aseguramiento de calidad desde cuando se desarrolló la aplicación?
5. ¿Existen procedimientos de recuperación ante desastres para los datos de la aplicación?


#### Preguntas para Administradores de Sistemas

1. ¿Existen sistemas que podrían ser caracterizados como frágiles? (sistemas con tendencia a fallar, sistemas operativos más antiguos o que no han sido parcheados)
2. ¿Existen sistemas en la red que el cliente no posee y que pueden requerir aprobación adicional para ser probados?
3. ¿Existen procedimientos de gestión de cambios en su lugar?
4. ¿Cuál es el tiempo promedio para reparar interrupciones del sistema?
5. ¿Existe algún software de monitoreo de sistemas en su lugar?
6. ¿Cuáles son los servidores y aplicaciones más críticos?
7. ¿Se prueban las copias de seguridad regularmente?
8. ¿Cuándo fue la última vez que se restauraron las copias de seguridad?

## Scope Creep (Ampliación de alcance)

La ampliación de alcance es una de las formas más eficientes de hacer que una empresa de pruebas de penetración quiebre.

Hay un par de cosas que recordar sobre esto:

1. Primero, si un cliente está satisfecho con el trabajo realizado en una prueba en particular, es muy común que soliciten trabajo adicional. Tómalo como un cumplido y no dudes en solicitar financiación adicional para compensar el tiempo extra invertido. Si el cliente se niega a pagar por el trabajo adicional, casi nunca vale la pena seguir trabajando en eso.
2. Al tratar con clientes existentes, asegúrate de mantener los precios bajos. Aprovechar una buena situación mediante el aumento de precios es una manera segura de alejar los negocios repetidos. Ten en cuenta que los precios pueden reducirse ya que la empresa evitó los costos de adquirir al cliente, como el proceso formal de solicitud de propuestas y la búsqueda del cliente en sí mismo. Además, la mejor fuente para futuros trabajos es a través de clientes existentes. Trátalos bien y volverán.

### Specify Start and End Dates